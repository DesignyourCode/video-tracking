/*!
 * Tracking for Youtube and HTML5 Videos
 * @version 1.0.0
 * @author DesignyourCode
 * @license The MIT License (MIT)
 */
!function(e){e.fn.trackVideo=function(t){return"undefined"!=typeof ga?(this.each(function(){function i(e){var t=e/4;sessionStorage.setItem("one",t),sessionStorage.setItem("two",2*t),sessionStorage.setItem("three",3*t)}function a(e){var t=e.currentTime;t>=sessionStorage.getItem("one")&&t<sessionStorage.getItem("two")?(ga("send","event",v,"25% video played",g),c.kissmetrics===!0&&_kmq.push(["record",v,{"video asset 25% video played":g}]),sessionStorage.setItem("one",null)):t>=sessionStorage.getItem("two")&&t<sessionStorage.getItem("three")?(ga("send","event",v,"50% video played",g),c.kissmetrics===!0&&_kmq.push(["record",v,{"video asset 50% video played":g}]),sessionStorage.setItem("two",null)):t>=sessionStorage.getItem("three")&&(ga("send","event",v,"75% video played",g),c.kissmetrics===!0&&_kmq.push(["record",v,{"video asset 75% video played":g}]),sessionStorage.setItem("three",null))}function s(){ga("send","event",v,"100% video played",g),c.kissmetrics===!0&&_kmq.push(["record",v,{"100% video played":g}])}function d(){ga("send","event",v,"video played",g),c.kissmetrics===!0&&_kmq.push(["record",v,{"video played":g}]),i(this.duration)}function o(e){var t=e.currentTime,i=e.duration;ga("send","event",v,"video paused",g),c.kissmetrics===!0&&_kmq.push(["record",v,{"video paused at":t+"/"+i}])}var n=e(this).data("track-video");if("youtube"===n){var r=document.createElement("script");r.src="https://www.youtube.com/iframe_api";var u=document.getElementsByTagName("script")[0];u.parentNode.insertBefore(r,u);var c=e.extend({playerVars:{},kissmetrics:!1},t),l=[];e('[id^="player-"]').each(function(){function t(e){return new YT.Player("player-"+e.videoId,{height:e.height,width:e.width,videoId:e.videoId,playerVars:c.playerVars,events:{onStateChange:i}})}function i(t){for(var i=0;i<l.length;i++){var r=l[i].id;d=e("#"+r).attr("data-title")?e("#"+r).data("title"):void 0!==l[i].videoTitle?l[i].videoTitle:"No video title set"}t.data===-1?o="Unstarted":0===t.data?o="Ended":1===t.data?o="Playing":2===t.data?(clearTimeout(n),n=setTimeout(function(){s(t,t.target.getCurrentTime())},2e3)):3===t.data?o="Buffering":5===t.data&&(o="Video cued"),2!==t.data&&a(t.data,t.target.getCurrentTime())}function a(e,t){ga("send","event","Videos",o,d,parseInt(t)),c.kissmetrics===!0&&_kmq.push(["record","Videos",{"video-title":d,"video-state":o,"video-time":parseInt(t)}])}function s(e,t){2===e.data&&(o="Paused",a(e.data,t))}var d,o,n,r=e(this).data("height")?e(this).data("height"):480,u=(e(this).data("width")?e(this).data("width"):853,e(this).attr("id").replace("player-",""));l.push({id:e(this).attr("id"),height:r,width:e(this).data("width"),videoId:u,videoTitle:d}),window.onYouTubeIframeAPIReady=function(){if("undefined"!=typeof l)for(var e=0;e<l.length;e++){t(l[e])}}})}else if("html5"===n){var v,c=e.extend({kissmetrics:!1},t),h=e(this),g=h.data("title");v=void 0===h.data("gacategory")?"video":h.data("gacategory"),h.bind("ended",s),h.bind("timeupdate",function(){a(this)}),h.bind("play",d),h.bind("pause",function(){o(this)})}else console.warn("It looks like your video type isn't correct. Options include: html5 | youtube")}),this):void console.warn("Google Analytics is not installed")}}(jQuery);